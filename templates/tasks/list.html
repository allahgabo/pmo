{% extends 'base.html' %}

{% block title %}My Tasks - PMO AI Assistant{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">My Tasks</h1>
    <p class="text-gray-600 mt-2">View and manage your assigned tasks</p>
</div>

<!-- Filter -->
<div class="bg-white rounded-lg shadow-md p-4 mb-6">
    <form method="get" class="flex gap-4">
        <select name="status" class="border rounded-lg px-4 py-2 flex-1" onchange="this.form.submit()">
            <option value="">All Status</option>
            <option value="not_started" {% if request.GET.status == 'not_started' %}selected{% endif %}>Not Started</option>
            <option value="in_progress" {% if request.GET.status == 'in_progress' %}selected{% endif %}>In Progress</option>
            <option value="completed" {% if request.GET.status == 'completed' %}selected{% endif %}>Completed</option>
            <option value="blocked" {% if request.GET.status == 'blocked' %}selected{% endif %}>Blocked</option>
        </select>
        <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition">
            Filter
        </button>
    </form>
</div>

<!-- Tasks List -->
{% if tasks %}
<div class="space-y-4">
    {% for task in tasks %}
    <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
        <div class="flex justify-between items-start mb-4">
            <div class="flex-1">
                <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ task.name }}</h3>
                <p class="text-sm text-gray-600">{{ task.project.name }}</p>
            </div>
            <div class="flex flex-col items-end space-y-2">
                <span class="px-3 py-1 text-xs rounded-full {% if task.status == 'completed' %}bg-green-100 text-green-800{% elif task.status == 'in_progress' %}bg-blue-100 text-blue-800{% elif task.status == 'blocked' %}bg-red-100 text-red-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ task.get_status_display }}
                </span>
                {% if task.is_milestone %}
                <span class="px-3 py-1 text-xs rounded-full bg-purple-100 text-purple-800">
                    <i class="fas fa-flag mr-1"></i>Milestone
                </span>
                {% endif %}
            </div>
        </div>
        
        {% if task.description %}
        <p class="text-gray-700 mb-4">{{ task.description }}</p>
        {% endif %}
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-sm">
            <div>
                <p class="text-gray-600">Due Date</p>
                <p class="font-semibold text-gray-900">{{ task.due_date }}</p>
            </div>
            <div>
                <p class="text-gray-600">Progress</p>
                <p class="font-semibold text-gray-900">{{ task.completion_percentage }}%</p>
            </div>
            <div>
                <p class="text-gray-600">Planned Hours</p>
                <p class="font-semibold text-gray-900">{{ task.planned_hours }}h</p>
            </div>
            <div>
                <p class="text-gray-600">Actual Hours</p>
                <p class="font-semibold text-gray-900">{{ task.actual_hours }}h</p>
            </div>
        </div>
        
        <div class="flex justify-between items-center pt-4 border-t border-gray-200">
            <div class="flex items-center space-x-4 text-sm text-gray-600">
                {% if task.is_overdue and task.status not in 'completed,cancelled' %}
                <span class="text-red-600 font-semibold">
                    <i class="fas fa-exclamation-triangle mr-1"></i>Overdue
                </span>
                {% else %}
                <span>
                    <i class="fas fa-calendar mr-1"></i>{{ task.days_until_due }} days remaining
                </span>
                {% endif %}
            </div>
            <a href="{% url 'project_detail' task.project.id %}" 
               class="text-purple-600 hover:text-purple-800 text-sm font-semibold">
                View Project <i class="fas fa-arrow-right ml-1"></i>
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="bg-white rounded-lg shadow-md p-12 text-center">
    <i class="fas fa-tasks text-6xl text-gray-300 mb-4"></i>
    <p class="text-gray-500 text-lg">No tasks assigned</p>
</div>
{% endif %}
{% endblock %}
